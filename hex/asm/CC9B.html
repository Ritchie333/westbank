<!DOCTYPE html>
<html>
<head>
<title>West Bank: Routine at CC9B</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../westbank.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="CC99.html">CC99</a>
</td>
<td class="up">Up: <a href="../maps/all.html#52379">Map</a></td>
<td class="next">
Next: <a href="CD1B.html">CD1B</a>
</td>
</tr>
</table>
<div class="description">CC9B: Draws Deposit Cashboxes.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="C7C0.html">NEW_GAME</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="52379"></span>CC9B</td>
<td class="instruction">LD A,($D45C)</td>
<td class="comment-1" rowspan="5">Converts <a href="D45C.html">CASHBOX_REF</a> into cash deposit box flag address (e.g. "1" becomes <a href="CC8D.html">DOOR_DEPOSITED_01</a> and so on).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52382"></span>CC9E</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52383"></span>CC9F</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52385"></span>CCA1</td>
<td class="instruction">LD DE,$CC8C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52388"></span>CCA4</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52389"></span>CCA5</td>
<td class="instruction">LD IX,$D165</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="D165.html#53613">DOOR_1_CASH_ACTION</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52393"></span>CCA9</td>
<td class="instruction">LD A,(IX+$08)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52396"></span>CCAC</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52397"></span>CCAD</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52398"></span>CCAE</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52399"></span>CCAF</td>
<td class="instruction">LD IX,$D173</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="D173.html#53627">DOOR_2_CASH_ACTION</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52403"></span>CCB3</td>
<td class="instruction">LD A,(IX+$08)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52406"></span>CCB6</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52407"></span>CCB7</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52408"></span>CCB8</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52409"></span>CCB9</td>
<td class="instruction">LD IX,$D181</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="D181.html#53641">DOOR_3_CASH_ACTION</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52413"></span>CCBD</td>
<td class="instruction">LD A,(IX+$08)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52416"></span>CCC0</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52417"></span>CCC1</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52418"></span>CCC2</td>
<td class="instruction">LD DE,$CC99</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="CC99.html">DOOR_DEPOSITED_01_06</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52421"></span>CCC5</td>
<td class="instruction">LD HL,$CC8D</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="CC8D.html">DOOR_DEPOSITED_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52424"></span>CCC8</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Fetch the flag for <a href="CC99.html">DOOR_DEPOSITED_01_06</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52425"></span>CCC9</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">Run a logical OR against the contents of <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52426"></span>CCCA</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Writes this back into <span class="register">HL</span> (setting the flag).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52427"></span>CCCB</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52428"></span>CCCC</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Move onto <a href="CC99.html#52378">DOOR_DEPOSITED_07_12</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52429"></span>CCCD</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Fetch the flag for <a href="CC99.html#52378">DOOR_DEPOSITED_07_12</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52430"></span>CCCE</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">Run a logical OR against the contents of <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52431"></span>CCCF</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Writes this back into <span class="register">HL</span> (setting the flag).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52432"></span>CCD0</td>
<td class="instruction">CALL <a href="CC9B.html#52475">GAME_CASHBOXES</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label">CASHBOXES_COMPLETE</td>
<td class="address-1"><span id="52435"></span>CCD3</td>
<td class="instruction">LD DE,$CC8D</td>
<td class="comment-1" rowspan="1">Points to the cashbox flags (beginning at <a href="CC8D.html">DOOR_DEPOSITED_01</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52438"></span>CCD6</td>
<td class="instruction">LD HL,$CA80</td>
<td class="comment-1" rowspan="2">Write $00 to <a href="C7C0.html#51840">CASHBOXES_COMPLETED_FLAG</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52441"></span>CCD9</td>
<td class="instruction">LD (HL),$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52443"></span>CCDB</td>
<td class="instruction">LD B,$0C</td>
<td class="comment-1" rowspan="1">Testing against all 12 cashboxes.</td>
</tr>
<tr>
<td class="asm-label">CASHBOXES_COMPLETE_LOOP</td>
<td class="address-2"><span id="52445"></span>CCDD</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="3">Fetch the cashbox flag, return if its zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52446"></span>CCDE</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52447"></span>CCDF</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52448"></span>CCE0</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="2">Move onto the next cashbox (loop back to <a href="CC9B.html#52445">CASHBOXES_COMPLETE_LOOP</a>) or continue once all 12 are checked.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52449"></span>CCE1</td>
<td class="instruction">DJNZ <a href="CC9B.html#52445">CASHBOXES_COMPLETE_LOOP</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52451"></span>CCE3</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="2">Write <span class="register">A</span> ($01) to <a href="C7C0.html#51840">CASHBOXES_COMPLETED_FLAG</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52452"></span>CCE4</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="asm-label">DRAW_GAME_CASHBOX</td>
<td class="address-2"><span id="52453"></span>CCE5</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="10">Determines whether to send <a href="FF78.html">EMPTY_BOX_IMAGE</a> or <a href="FF78.html#65432">DOLLAR_BOX_IMAGE</a> to <a href="D5E6.html">COPY_ROUTINE</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52454"></span>CCE6</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52455"></span>CCE7</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52456"></span>CCE8</td>
<td class="instruction">LD DE,$FF78</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52459"></span>CCEB</td>
<td class="instruction">LD A,(IX+$00)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52462"></span>CCEE</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52463"></span>CCEF</td>
<td class="instruction">JR Z,$CCF4</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52465"></span>CCF1</td>
<td class="instruction">LD DE,$FF98</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="52468"></span>CCF4</td>
<td class="instruction">LD BC,$1002</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52471"></span>CCF7</td>
<td class="instruction">CALL <a href="D5E6.html">COPY_ROUTINE</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52474"></span>CCFA</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="52475"></span>
<div class="comments">
<div class="paragraph">
Draws all the cashboxes in two blocks of 6.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">GAME_CASHBOXES</td>
<td class="address-2"><span id="52475"></span>CCFB</td>
<td class="instruction">LD IX,$CC8D</td>
<td class="comment-1" rowspan="16">The statuses for the cashboxes begin at <a href="CC8D.html">DOOR_DEPOSITED_01</a>. This routine processes them in two blocks of 6 (as they appear. The first block is displayed at $401F, after processing the subroutine returns and continues for the next six blocks, just altering the screen location to $4025.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52479"></span>CCFF</td>
<td class="instruction">LD HL,$401F</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52482"></span>CD02</td>
<td class="instruction">LD A,$01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52484"></span>CD04</td>
<td class="instruction">CALL <a href="CC9B.html#52490">GAME_CASHBOXES_SKIP</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52487"></span>CD07</td>
<td class="instruction">LD HL,$4025</td>
</tr>
<tr>
<td class="asm-label">GAME_CASHBOXES_SKIP</td>
<td class="address-2"><span id="52490"></span>CD0A</td>
<td class="instruction">LD B,$06</td>
</tr>
<tr>
<td class="asm-label">GAME_CASHBOXES_LOOP</td>
<td class="address-2"><span id="52492"></span>CD0C</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52493"></span>CD0D</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52494"></span>CD0E</td>
<td class="instruction">PUSH AF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52495"></span>CD0F</td>
<td class="instruction">CALL <a href="CC9B.html#52453">DRAW_GAME_CASHBOX</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52498"></span>CD12</td>
<td class="instruction">POP AF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52499"></span>CD13</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52500"></span>CD14</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52501"></span>CD15</td>
<td class="instruction">INC IX</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52503"></span>CD17</td>
<td class="instruction">INC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52504"></span>CD18</td>
<td class="instruction">DJNZ <a href="CC9B.html#52492">GAME_CASHBOXES_LOOP</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="52506"></span>CD1A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="CC99.html">CC99</a>
</td>
<td class="up">Up: <a href="../maps/all.html#52379">Map</a></td>
<td class="next">
Next: <a href="CD1B.html">CD1B</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; DINAMIC SOFTWARE 1985</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.6.</div>
<div><a href="../../dec/asm/52379.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>